<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>资源</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="/css/font.css">
	<link rel="stylesheet" href="/css/weadmin.css">
	<style>
		.menuWidth{width: 60%}
		.selectWidth{width: 48%}
		.childrenBody{margin-top: 20px}
	</style>
</head>
<body class="childrenBody">
<form class="layui-form linksAdd">
	<input type="hidden" value="" id="id" name="id">
	<input type="hidden" value="" id="parentId" name="parentId">
	<div class="layui-form-item">
		<label class="layui-form-label">菜单名称</label>
		<div class="layui-input-block">
			<input type="text" id="name" class="layui-input name menuWidth" name="name" lay-verify="required" placeholder="请输入菜单名称">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">菜单等级</label>
		<div class="layui-input-block selectWidth">
			<select name="levels" id="levels">
				<option value="1">一级菜单</option>
				<option value="2">二级菜单</option>
			</select>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">父级菜单</label>
		<div class="layui-input-block selectWidth">
			<select name="parentId" id="parentIdSelect" lay-filter="parentId" lay-verify="required">
				<option value="0">根目录</option>
			</select>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">菜单路径</label>
		<div class="layui-input-block">
			<input type="text" class="layui-input menuWidth" name="url" id="url" lay-verify="required" placeholder="请输入菜单路径">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">菜单顺序</label>
		<div class="layui-input-block">
			<input type="text" id="sort" class="layui-input sort menuWidth" name="sort" lay-verify="required" placeholder="请输入菜单顺序">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">权限状态</label>
		<div class="layui-input-block selectWidth">
			<select name="status" id="status">
				<option value="1">启用</option>
				<option value="0">禁用</option>
			</select>
			<!--<input type="hidden" id="status" name="status">
			<input type="checkbox" id="statusCheckbox" checked=""  lay-skin="switch" lay-filter="switchStatus" lay-text="ON|OFF">-->
		</div>
	</div>
	<div class="layui-form-item">
		<button style="margin-left: 200px;" class="layui-btn layui-block" lay-filter="addMenu" lay-submit>保存</button>
	</div>
</form>
	<script src="/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    layui.use(['form','layer'],function(){
        var form = layui.form,
            layer = parent.layer === undefined ? layui.layer : top.layer,
            $ = layui.jquery;

        $.post("/businesse//projMenu/getParentMenu",function(data){
            var parentMenu = data.data;
            parentMenu.forEach(function(e){
                $("#parentIdSelect").append("<option value='"+e.id+"'>"+e.name+"</option>");
            });
            //编辑
            if($("#parentId").val()!==""){
                $("#parentIdSelect").val($("#parentId").val());//默认选中
                $("#parentIdSelect").attr("disabled","disabled");
            }
            form.render('select');//重新渲染

           /* if($("#status").val()!==""){
				if($("#status").val()=='1'){
                    $("#statusCheckbox").attr("checked");
				}else {
                    $("#statusCheckbox").removeAttr("checked");
				}
            }*/
            form.render();//重新渲染
        });

       /* form.on('switch(switchStatus)', function(data){
            var flag = (this.checked ? '1' : '0');
            if(flag=='1'){
                $("#status").val('1');
            }else {
                $("#status").val('0');
            }
        });*/

        form.on("submit(addMenu)",function(data){
            //弹出loading
            var index = top.layer.msg('数据保存中，请稍候...',{icon: 16,time:false,shade:0.8});
            $.post("/businesse/projMenu/saveMenu",data.field,function(res){
                layer.close(index);
                if (res.code =='0'){
                    layer.msg("保存成功！");
                    layer.closeAll("iframe");
                    //刷新父页面
                    parent.location.reload();
                } else {
                    layer.msg(res.msg);
                }
            });
            return false;
        });

    })
</script>
</body>
</html>